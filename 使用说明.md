# Power BI 自动刷新插件使用说明

## 功能概述

这是一个基于TamperMonkey的浏览器插件，专门用于自动刷新Power BI数据模型和报表。插件支持两种页面类型的自动化操作：

1. **Semantic Model页面** - 自动刷新数据模型
2. **Report页面** - 自动刷新报表并切换到全屏模式

## 安装步骤

1. **安装TamperMonkey扩展**
   - Chrome: 访问 Chrome Web Store 搜索"Tampermonkey"
   - Firefox: 访问 Firefox Add-ons 搜索"Tampermonkey"
   - Edge: 访问 Microsoft Edge Add-ons 搜索"Tampermonkey"

2. **安装脚本**
   - 打开TamperMonkey控制面板
   - 点击"添加新脚本"
   - 复制`powerbi-auto-refresh.user.js`文件内容
   - 粘贴到编辑器中并保存

3. **启用脚本**
   - 确保脚本状态为"启用"
   - 访问 https://app.powerbi.com 确认脚本正常加载

## 功能特性

### 🔄 自动刷新功能
- **定时刷新**: 支持30分钟、1小时、2小时、3小时间隔
- **智能识别**: 自动识别当前页面类型（Semantic Model 或 Report）
- **状态提示**: 实时显示刷新状态和倒计时

### 📊 Semantic Model 刷新流程
1. 自动点击页面上的"Refresh"按钮
2. 等待菜单展开（1秒）
3. 点击"Refresh now"按钮
4. 等待数据刷新完成（60秒）

### 📈 Report 刷新流程
1. 检查并退出全屏模式（如果处于全屏状态）
2. 点击"Refresh visuals"按钮
3. 等待视觉效果刷新（30秒）
4. 打开视图菜单
5. 点击"Full screen"切换到全屏模式

### ⚙️ 设置面板功能
- **页面类型显示**: 实时显示当前页面类型
- **自动刷新开关**: 一键启用/禁用自动刷新
- **间隔时间设置**: 可选择不同的刷新间隔
- **倒计时显示**: 显示距离下次刷新的剩余时间
- **立即刷新**: 手动触发一次刷新操作
- **拖动功能**: 鼠标拖动标题栏可移动面板位置
- **位置记忆**: 自动保存和恢复面板位置
- **位置重置**: 双击标题栏重置到默认位置

### ⌨️ 快捷键功能
- **Shift+Alt+H**: 快速显示/隐藏状态指示器
- **快捷键提示**: 设置面板中显示快捷键信息

### 🖥️ 智能全屏适配
- **自动隐藏**: 进入全屏模式时自动隐藏指示器
- **自动显示**: 退出全屏模式时自动显示指示器
- **多种全屏支持**: 支持浏览器全屏和Power BI内置全屏模式

## 使用方法

### 1. 基本使用
- 脚本会在Power BI页面自动加载
- 页面右上角会出现蓝色的🔄图标
- 点击图标打开设置面板
- 长按并拖动🔄图标可以移动其位置

### 2. 启用自动刷新
1. 点击🔄图标打开设置面板
2. 勾选"启用自动刷新"
3. 选择合适的刷新间隔
4. 点击"保存设置"

### 3. 手动刷新
- 在设置面板中点击"立即刷新"按钮
- 或使用TamperMonkey菜单中的"立即刷新"命令

### 4. 拖动操作
- **拖动状态指示器**: 长按🔄图标150ms后拖动可移动位置
- **拖动设置面板**: 鼠标拖动面板标题栏(带📌图标的部分)可移动面板
- **重置位置**: 双击设置面板标题栏可重置到默认位置
- **位置保存**: 拖动后的位置会自动保存，下次打开时恢复

### 5. 快捷键操作
- **Shift+Alt+H**: 快速切换指示器显示/隐藏状态
- **全屏自动适配**: 进入全屏时自动隐藏，退出全屏时自动显示
- **手动控制**: 可通过TamperMonkey菜单手动控制显示状态

### 6. 菜单命令
右键点击TamperMonkey图标 → 选择脚本 → 可使用以下命令：
- 打开设置面板
- 立即刷新
- 启动自动刷新
- 停止自动刷新
- 显示/隐藏指示器 (Shift+Alt+H)
- 显示指示器
- 隐藏指示器

## 通知系统

插件提供三种类型的通知：
- **信息通知**（蓝色）: 操作进度提示
- **成功通知**（绿色）: 操作成功完成
- **错误通知**（红色）: 操作失败或异常

## 注意事项

### ⚠️ 使用前提
- 确保Power BI页面完全加载完成
- 需要有相应的页面操作权限
- 网络连接稳定

### 🛡️ 安全考虑
- 脚本仅在app.powerbi.com域名下运行
- 不会收集或传输任何个人数据
- 所有设置存储在本地浏览器中

### 🔧 故障排除
1. **脚本未加载**
   - 检查TamperMonkey是否启用
   - 确认脚本状态为"启用"
   - 刷新页面重试

2. **找不到按钮**
   - 确认页面类型正确
   - 等待页面完全加载
   - 检查Power BI界面是否有更新

3. **自动刷新不工作**
   - 检查设置是否正确保存
   - 确认"启用自动刷新"已勾选
   - 查看浏览器控制台错误信息

## 技术说明

### 支持的CSS选择器
```css
/* Semantic Model 页面 */
#model-actionbar-refresh              /* Refresh 按钮 */
button[title="Refresh now"]           /* Refresh Now 按钮 */

/* Report 页面 */
#reportAppBarRefreshBtn               /* Refresh visuals 按钮 */
button[data-testid="app-bar-view-menu-btn"]     /* 视图菜单按钮 */
button[data-testid="open-in-full-screen-btn"]   /* 全屏按钮 */
```

### 配置参数
- Semantic Model刷新等待时间: 60秒
- Report刷新等待时间: 30秒
- 菜单展开等待时间: 1秒
- 元素查找超时时间: 10秒

## 更新日志

### v1.0.0
- 初始版本发布
- 支持Semantic Model和Report两种页面类型
- 实现定时自动刷新功能
- 添加可视化设置面板
- 集成倒计时显示功能